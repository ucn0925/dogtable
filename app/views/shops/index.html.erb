<h1>店鋪一覧</h1>

<!-- 検索フォーム部分 -->
<%= form_with url: shops_path, method: :get, local: true do %>
  <div style="display: flex; gap: 10px; align-items: center; margin: 16px 0;">

    <!-- 店名検索 -->
    <%= text_field_tag :keyword, params[:keyword],
        placeholder: "店名で検索",
        style: "width: 200px; padding: 6px;" %>
 
    <!-- ジャンル選択 -->
    <%= select_tag :genre_id, 
        options_from_collection_for_select(Genre.all, :id, :name, params[:genre_id]), 
        include_blank: "ジャンルを選択",
        style: "padding: 6px;" %>  

    <!-- 検索ボタン -->
    <%= submit_tag "検索" %>

  </div>
<% end %>

<hr>

<!-- 検索パラメータがある時だけ、件数やリセットリンクを表示 -->
<% if params[:keyword].present? || params[:genre_id].present? || params[:area_id].present? %>
  <div style= "margin-top: 10px;">
    <p>検索結果：<%= @shops.count %>件</p>
    <%= link_to "検索条件をリセット", shops_path, style: "text-decoration: underline; color: gray;" %>
  </div>

  <!-- 検索結果がある場合と０件の場合を分ける -->
  <% if @shops.any? %>
    <% @shops.each do |shop| %>
      <div style="margin-bottom: 16px;">
        <h2><%= link_to shop.name, shop_path(shop) %></h2>
        <p><%= shop.address %></p>
        <p><%= shop.genre.name %> ／ <%= shop.block.name %></p>
      </div>
    <% end %>
  <% else %>
    <!-- 該当したけど０件のときだけ表示 -->
    <p>該当する店舗が見つかりませんでした。</p>
  <% end %>

  <% else %>
    <!-- 検索していないとき（通常の一覧表示） -->
    <% @shops.each do |shop| %>
      <div style="margin-bottom: 16px;">
        <h2><%= link_to shop.name, shop_path(shop) %></h2>
        <p><%= shop.address %></p>
        <p><%= shop.genre.name %> ／ <%= shop.block.name %></p>
        <p>♡ <%= shop.shop_favorites.count %> 💬 <%= shop.posts.count %></p>
      </div>
    <% end %>
  <% end %> 

<!-- 新しい店舗を登録するリンク -->
<%= link_to "新しい店鋪を登録する", new_shop_path %>