<div class="container mt-4">

  <h1>店鋪一覧</h1>

  <!-- 検索フォーム部分 -->
  <%= form_with url: shops_path, method: :get, local: true do %>
    <div class="d-flex gap-2 align-items-center my-3">

      <!-- 店名検索 -->
      <%= text_field_tag :keyword, params[:keyword],
          placeholder: "店名で検索",
          class: "form-control",
          style: "max-width: 200px;" %>
 
      <!-- ジャンル選択 -->
      <%= select_tag :genre_id, 
          options_from_collection_for_select(Genre.all, :id, :name, params[:genre_id]), 
          include_blank: "ジャンルを選択",
          class: "form-select",
          style: "max-width: 180px;" %>  

      <!-- 検索ボタン -->
      <%= submit_tag "検索", class: "btn btn-primary" %>

    </div>
  <% end %>

<hr>

   <!-- 検索パラメータがある時だけ、件数やリセットリンクを表示 -->
  <% if params[:keyword].present? || params[:genre_id].present? || params[:area_id].present? %>
    <div class="mt-3">
      <p>検索結果：<%= @shops.count %>件</p>
      <%= link_to "検索条件をリセット", shops_path, class: "text-secondary text-decoration-underline" %>
    </div>

    <!-- 検索結果がある場合 -->
    <% if @shops.any? %>
      <% @shops.each do |shop| %>
        <div class="carf mb-3 p-3">
          <h2 class="h5"><%= link_to shop.name, shop_path(shop), class: "text-decoration-none" %></h2>
          <p><%= shop.address %></p>
          <p><%= shop.genre.name %> ／ <%= shop.block.name %></p>
        </div>
      <% end %>

      <%= paginate @shops %>

    <% else %>
      <!-- 該当０件 -->
      <p>該当する店舗が見つかりませんでした。</p>
    <% end %>

    <% else %>
      <!-- 検索していないとき（通常の一覧表示） -->
      <% @shops.each do |shop| %>
        <div class="card mb-3 p-3">
          <h2 class="h5"><%= link_to shop.name, shop_path(shop), class: "text-decoration-none" %></h2>
          <p><%= shop.address %></p>
          <p><%= shop.genre.name %> ／ <%= shop.block.name %></p>
          <p>♡ <%= shop.shop_favorites.count %> 💬 <%= shop.posts.count %></p>
        </div>
      <% end %>

      <%= paginate @shops %>
    
    <% end %> 

  <!-- 新しい店舗を登録するリンク -->
  <div class="d-flex justify-content-center mt-4">
    <%= link_to "＋ 新しい店鋪を登録する", new_shop_path,
          class: "btn btn-light btn-lg px-4 py-3 rounded-pill border" %>
  </div>

</div>