<div class="container mt-4">

  <h1 class="page-title">Â∫óÈã™‰∏ÄË¶ß</h1>

  <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É†ÈÉ®ÂàÜ -->
  <%= form_with url: shops_path, method: :get, local: true do %>
    <div class="d-flex gap-2 align-items-center my-3">

      <!-- Â∫óÂêçÊ§úÁ¥¢ -->
      <%= text_field_tag :keyword, params[:keyword],
          placeholder: "Â∫óÂêç„ÅßÊ§úÁ¥¢",
          class: "form-control",
          style: "max-width: 200px;" %>
 
      <!-- „Ç∏„É£„É≥„É´ÈÅ∏Êäû -->
      <%= select_tag :genre_id, 
          options_from_collection_for_select(Genre.all, :id, :name, params[:genre_id]), 
          include_blank: "„Ç∏„É£„É≥„É´„ÇíÈÅ∏Êäû",
          class: "form-select",
          style: "max-width: 180px;" %>  

      <!-- Ê§úÁ¥¢„Éú„Çø„É≥ -->
      <%= submit_tag "Ê§úÁ¥¢", class: "btn shop-search-btn" %>

    </div>
  <% end %>

<hr>

   <!-- Ê§úÁ¥¢„Éë„É©„É°„Éº„Çø„Åå„ÅÇ„ÇãÊôÇ„Å†„Åë„ÄÅ‰ª∂Êï∞„ÇÑ„É™„Çª„ÉÉ„Éà„É™„É≥„ÇØ„ÇíË°®Á§∫ -->
  <% if params[:keyword].present? || params[:genre_id].present? || params[:area_id].present? %>
    <div class="mt-3">
      <p>Ê§úÁ¥¢ÁµêÊûúÔºö<%= @shops.count %>‰ª∂</p>
      <%= link_to "Ê§úÁ¥¢Êù°‰ª∂„Çí„É™„Çª„ÉÉ„Éà", shops_path, class: "reset-link" %>
    </div>

    <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„ÅÇ„ÇãÂ†¥Âêà -->
    <% if @shops.any? %>
      <% @shops.each do |shop| %>
        <div class="card shop-card mb-3 mx-auto">
          <div class="d-flex align-items-start" style="gap:30px;">

          <!-- „Çµ„É†„Éç„Ç§„É´ÂÜôÁúü -->
          <% if shop.images.attached? %>
            <%= image_tag shop.images.first.variant(resize_to_fill: [120, 120]),
                  class: "rounded",
                  style: "width: 120px; height: 120px; object-fit: cover;" %>
          <% else %>
            <div style=
              "width:120px; 
              height:120px; 
              background: #eee; 
              border-radius:8px;
              display:flex;
              align-items:center;
              justify-content:center;
              color:#999;
              font-size:12px;
            ">
              NO IMAGE
            </div>
          <% end %>

          <!-- Â∫óËàóÊÉÖÂ†± -->
          <div>
            <h2 class="h5 mb-1">
              <%= link_to shop.name, shop_path(shop), 
                    class: "shop-name text-decoration-none" %>
            </h2>
            <p class="mb-1"><%= shop.address %></p>
            <p class="mb-1"><%= shop.genre.name %> Ôºè <%= shop.block.name %></p>
            <p class="text-muted">
              ‚ô° <%= shop.shop_favorites.count %>
              üí¨ <%= shop.posts.count %>
            </p>
          </div>

          </div>
        </div>
      <% end %>

      <%= paginate @shops,
            previous_label: "Ââç„Å∏",
            next_label: "Ê¨°„Å∏",
            first_label: "ÊúÄÂàù",
            last_label: "ÊúÄÂæå" %>

    <% else %>
      <!-- Ë©≤ÂΩìÔºê‰ª∂ -->
      <p>Ë©≤ÂΩì„Åô„ÇãÂ∫óËàó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>
    <% end %>

    <% else %>
      <!-- Ê§úÁ¥¢„Åó„Å¶„ÅÑ„Å™„ÅÑ„Å®„ÅçÔºàÈÄöÂ∏∏„ÅÆ‰∏ÄË¶ßË°®Á§∫Ôºâ -->
      <% @shops.each do |shop| %>
        <div class="card shop-card mb-3 mx-auto">
          <div class="d-flex align-items-start" style="gap:30px;">

            <!-- „Çµ„É†„Éç„Ç§„É´ÂÜôÁúü -->
            <% if shop.images.attached? %>
              <%= image_tag shop.images.first.variant(resize_to_fill: [120, 120]),
                    class: "rounded",
                    style: "width:120px; height:120px; object-fit: cover;" %>
            <% else %>
              <!-- ÁîªÂÉè„Åå„Å™„ÅÑ„Å®„Åç„ÅÆ„ÉÄ„Éü„Éº -->
              <div style="
                width:120px; 
                height:120px; 
                background:#eee; 
                border-radius: 8px;
                display:flex;
                align-items:center;
                justify-content:center;
                color:#999;
                font-size:12px;
              ">
                NO IMAGE
              </div>
            <% end %>
          

          <!-- Â∫óËàóÊÉÖÂ†± -->
          <div>
            <h2 class="h5 mb-1">
              <%= link_to shop.name, shop_path(shop), 
                    class: "shop-name text-decoration-none" %>
            </h2>
            <p class="mb-1"><%= shop.address %></p>
            <p class="mb-1"><%= shop.genre.name %> Ôºè <%= shop.block.name %></p>
            <p class="text-muted">‚ô° <%= shop.shop_favorites.count %> üí¨ <%= shop.posts.count %></p>
          </div>

          </div>
        </div>
      <% end %>

      <%= paginate @shops %>
    
    <% end %> 

  <!-- Êñ∞„Åó„ÅÑÂ∫óËàó„ÇíÁôªÈå≤„Åô„Çã„É™„É≥„ÇØ -->
  <div class="d-flex justify-content-center mt-4 mb-5">
    <%= link_to "Êñ∞„Åó„ÅÑÂ∫óËàó„ÇíÁôªÈå≤„Åô„Çã", new_shop_path,
          class: "shop-add-btn" %>
  </div>

</div>