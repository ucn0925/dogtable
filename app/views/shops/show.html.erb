<h1><%= @shop.name %></h1>
<p>♡ <%= @shop.shop_favorites.count %> 件のお気に入り</p>
<p>住所：<%= @shop.address %></p>
<p>ジャンル：<%= @shop.genre.name %></p>

<% if @shop.images.attached? %>
  <h3>店舗写真</h3>
  <div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <% @shop.images.each do |image| %>
      <%= image_tag image, style: "width: 200px; border-radius: 8px;" %>
    <% end %>
  </div>
<% end %>


<% if user_signed_in? %>
  <% if current_user.shop_favorites.exists?(shop_id: @shop.id) %>
    <%= link_to shop_shop_favorite_path(@shop), 
        data: { turbo_method: :delete, turbo_confirm: "お気に入りを解除しますか？" },
        class: "btn btn-outline-danger" do %>
      ♥ お気に入り解除
    <% end %>
  <% else %>
    <%= link_to shop_shop_favorite_path(@shop), 
        data: { turbo_method: :post },
        class: "btn btn-outline-primary" do %>
      ♡ お気に入り登録
    <% end %>
  <% end %>  
<% end %>

<%= link_to "編集する", edit_shop_path %>
<%= link_to "一覧に戻る", shops_path(@shop) %>
<%= link_to "削除する", shop_path(@shop), data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？"} %>

<hr>

<h3>コメント一覧</h3>

<% if @shop.comments.any? %>
  <% @shop.comments.order(created_at: :desc).each do |comment| %>
    <div style="margin: 8px 0; border-bottom; 1px solid #ccc, padding-bottom: 5px;">
      <p>
        <strong><%= comment.user.name if comment.user %></strong>
          (<%= comment.created_at.strftime("%Y/%m/%d %H:%M") %>)
      </p>
      <p><%= simple_format(h(comment.content)) %></p>
      <% if comment.user == current_user %>
        <%= link_to "編集", edit_shop_comment_path(@shop, comment), style: "margin-left: 10px;" %>
        <%= link_to "削除", shop_comment_path(@shop, comment), 
              data: { turbo_method: :delete, turbo_confirm: "このコメントを削除しますか？" }, 
              style: "color: red; margin-left: 10px;" %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <p>まだコメントはありません。</p>
<% end %>

<h2>コメント</h2>

<% if user_signed_in? %>
  <%= form_with(model: [@shop, @shop.comments.build], local: true) do |f| %>
    <div style="margin: 8px 0;">
      <%= f.text_area :content, row: 3, placeholder: "コメントを入力してください" %>
    </div>
      <%= f.submit "投稿する" %>
  <% end %>
<% else %>
  <p>コメントを投稿するにはログインが必要です。</p>
<% end %>

<hr>
