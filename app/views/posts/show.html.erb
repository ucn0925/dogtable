<div class="container py-4">

  <h2>口コミ詳細</h2>

  <div class="mb-3">
    <%= link_to "←店舗ページに戻る", shop_path(@shop), style: "color: #0073bb;" %>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">

    <!--ユーザー情報 -->
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <div>
        <strong style="font-size: 1.2em;">
          <%= link_to @post.user.name, user_path(@post.user), style: "color: #0073bb;" %>
        </strong>
        <span style= "color: #888; margin-left: 10px;">
          <%= @post.created_at.strftime("%Y/%m/%d %H:%M") %>
        </span>
      </div>

      <% if current_user == @post.user %>
        <div>
          <%= link_to "編集", edit_shop_post_path(@shop, @post), style: "margin-right: 8px; color: #0073bb;" %>
          <%= link_to "削除", shop_post_path(@shop, @post),
                data: { turbo_method: :delete, turbo_confirm: "削除してよろしいですか？" },
                style: "color: #bbb0000;" %>
        </div>
      <% end %>
    </div>

    <!-- 星の評価 -->
    <div class="mb-3">

      <!-- 総合評価 -->
      <div class="row align-items-center mb-1">
        <div class="col-3 text-muted small">総合評価：</div>
        <div class="col-9 text-start">
          <% 5.times do |i| %>
            <span class="<%= i < @post.rating_overall.to_i ? 'text-warning' : 'text-muted' %>">★</span>
          <% end %>
        </div>
      </div>

      <!-- 料理の評価 -->
      <div class="row align-items-center mb-1">
        <div class="col-3 text-muted small">料理の評価：</div>
        <div class="col-9 text-start">
          <% 5.times do |i| %>
            <span class="<%= i < @post.rating_food.to_i ? 'text-warning' : 'text-muted' %>">★</span>
          <% end %>
        </div>
      </div>

      <!-- 犬連れやすさ -->
      <div class="row align-items-center mb-1">
        <div class="col-3 text-muted small">犬連れやすさ：</div>
        <div class="col-9 text-start">
          <% 5.times do |i| %>
            <span class="<%= i < @post.rating_dog_friendliness.to_i ? 'text-warning' : 'text-muted' %>">★</span>
          <% end %>
        </div>
      </div>

    </div>

    <!-- 犬のサイズ -->
    <% if @post.dog_size.present? %>
      <div class="row align-items-center mb-1">
        <div class="col-3 text-muted small">
          一緒に行った犬のサイズ：
        </div>
        <div class="col-9">
          <%= case @post.dog_size
            when "small" then "小型犬"
            when "medium" then "中型犬"
            when "large" then "大型犬"
            else "未選択"
            end %>
      </div>
    <% end %>

    <!-- 訪問日 -->
    <% if @post.visited_on.present? %>
      <div class="row align-items-center mb-1">
        <div class="col-3 text-muted small">訪問日：</div>
        <div class="col-9">
          <%= @post.visited_on.strftime("%Y/%m/%d") %>
        </div>
      </div>
    <% end %>

    <!-- コメント本文 -->
    <hr class="my-3">

    <div class="mb-2 text-muted small">コメント</div>


    <div class="p-3 bg-light rounded mb-3">
      <%= simple_format(h(@post.content)) %>
    </div>

    <!--いいねボタン -->
    <div class="mt-3">
      <% if @post.favorited_by?(current_user) %>
        <%= button_to shop_post_post_favorite_path(@shop, @post),
              method: :delete,
              class: "btn btn-danger px-4 py-2 rounded-pill d-inline-flex align-items-center gap-1" do %>
          ❤︎ <span>いいね済み</span>
        <% end %>
      <% else %>
        <%= button_to shop_post_post_favorite_path(@shop, @post),
              method: :post,
              class: "btn btn-outline-danger px-4 py-2 rounded-pill d-inline-flex aline-items-center gap-1" do %>
          ♡ <span>いいね</span>
        <% end %>
      <% end %>
    </div>    

    <!-- 投稿画像 -->
    <% if @post.images.attached? %>
      <div class="d-flex gap-2 mt-3">
        <% @post.images.first(2).each do |image| %>
          <%= image_tag image.variant(resize_to_limit: [250, 250]),
                class: "img-fluid rounded shadow-sm" %>
        <% end %>
      </div>

      <% if @post.images.count > 2 %>
        <div class="mt-2">
          <%= link_to "写真をもっと見る（#{@post.images.count}枚）",
              photos_shop_post_path(@shop, @post),
              class: "btn btn-outline-secondary btn-sm" %>
        </div>
      <% end %>
    <% end %>

    </div>
  </div>

</div>

</div>