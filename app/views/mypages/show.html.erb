<h1><%= current_user.name %>さんのマイページ</h1>

<p>
  フォロー中：
  <%= link_to "#{current_user.followings.count}人", followings_user_path(current_user) %>
  ／
  フォロワー：
  <%= link_to "#{current_user.followers.count}人", followers_user_path(current_user) %>
</p>

<p>
  💬投稿数：<%= @posts.count %>件<br>
  ♡お気に入り店舗数：<%= @favorites.count %>件<br>
  ⭐️平均評価：
  <% if @posts.any? %>
    <% avg = @posts.average(:rating_overall).to_f.round(1) %>
    <% full = avg.floor %>
    <% frac = avg - full %>

    <%= avg %>
    <% 5.times do |i| %>
      <% if i <full %>
        <span style="color: gold;">★</span>
      <% elsif i == full && frac >= 0.5 %>
        <span style="color: gold;">☆</span>
      <% else %>
        <span style="color: #ccc;">★</span>
      <% end %>
    <% end %>
  <% else %>
    投稿なし
  <% end %>
</p>

<hr>

<h2>プロフィール</h2>
<p>自己紹介：<%= current_user.profile.presence || "未設定" %></p>

<% if current_user.profile_image.attached? %>
  <%= image_tag current_user.profile_image, size: "150x150", class: "rounded-full" %>
<% else %>
  <p>プロフィール画像はまだ設定されていません。</p>
<% end %>

<%= link_to "プロフィールを編集する", edit_user_registration_path, class: "btn" %>

<hr>

<h2>愛犬情報</h2>
<% if current_user.dog.present? %>
  <p>犬の名前：<%= current_user.dog.name %></p>
  <p>犬種：<%= current_user.dog.breed %></p>
  <p>犬のサイズ：<%= current_user.dog.size_jp %></p>

  <% if current_user.dog.dog_image.attached? %>
    <%= image_tag current_user.dog.dog_image, size: "200x200" %>
  <% else %>
    <p>愛犬の写真はまだ登録されていません。</p>
  <% end %>
<% else %>
  <p>愛犬情報はまだ登録されていません。</p>
<% end %>

<hr>

<h2>お気に入り店舗一覧</h2>
<% if @favorites.any? %>
  <ul>
    <% @favorites.each do |favorite| %>
        <li>
          <%= link_to favorite.shop.name, shop_path(favorite.shop) %>
        </li>
    <% end %>
  </ul>
<% else %>
  <p>お気に入り登録した店舗はまだありません。</p>
<% end %>

<hr>

<h2>投稿一覧</h2>
<% if @posts.any? %>
  <ul>
    <% @posts.each do |post| %>
        <li style="margin-bottom: 12px;">
          <strong><%= link_to post.shop.name, shop_path(post.shop) %></strong><br>
          投稿日：<%= post.created_at.strftime("%Y/%m/%d %H:%M") %><br>
          評価：
          <% (1..5).each do |i| %>
            <span style="color: <%= i <= (post.rating_overall || 0) ? 'gold' : '#ccc' %>;" >★</span>
          <% end %>
          <br>
          <%= simple_format(post.content) %>       
        </li>
    <% end %>
  </ul>
<% else %>
  <p>投稿はまだありません。</p>
<% end %>

   
